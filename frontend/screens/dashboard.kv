<DashboardScreen>:
    # Fond d'√©cran
    canvas.before:
        Color:
            rgba: 0.95, 0.95, 0.95, 1  # Gris clair
        Rectangle:
            pos: self.pos
            size: self.size

    # R√©f√©rences aux IDs
    search_input: search_input
    status_label: status_label
    table_grid: table_grid
    table_scroll: table_scroll
    header_scroll: header_scroll

    ScrollView:
        do_scroll_x: False
        do_scroll_y: True
        bar_width: dp(10)
        scroll_type: ['bars', 'content']
        effect_cls: 'ScrollEffect'

        BoxLayout:
            orientation: 'vertical'
            size_hint_y: None
            height: self.minimum_height
            padding: dp(15)
            spacing: dp(10)

            # En-t√™te
            BoxLayout:
                size_hint_y: None
                height: dp(50)
                padding: dp(10)
                spacing: dp(10)
                canvas.before:
                    Color:
                        rgba: 0.2, 0.5, 0.8, 1  # Bleu clair
                    Rectangle:
                        pos: self.pos
                        size: self.size

                Label:
                    text: "üìä Tableau de bord"
                    font_name: 'EmojiFont'
                    color: 1, 1, 1, 1
                    bold: True
                    font_size: '20sp'
                    halign: 'left'
                    valign: 'middle'
                    size_hint_x: 1
                    text_size: self.size

            # Contenu principal (barre lat√©rale + formulaire)
            BoxLayout:
                orientation: 'horizontal'
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(10)

                # Barre lat√©rale
                BoxLayout:
                    orientation: 'vertical'
                    size_hint_x: 0.2
                    padding: dp(10)
                    spacing: dp(10)
                    canvas.before:
                        Color:
                            rgba: 0.8, 0.8, 0.8, 1  # Gris moyen
                        Rectangle:
                            pos: self.pos
                            size: self.size

                    Button:
                        text: "‚ñ∂Ô∏è Accueil"
                        font_name: 'EmojiFont'
                        color: 0, 0, 0, 1
                        font_size: '16sp'
                        background_normal: ''
                        background_color: 0.9, 0.9, 0.9, 1
                        canvas.before:
                            Color:
                                rgba: 0.7, 0.7, 0.7, 1
                            Line:
                                rectangle: (self.x, self.y, self.width, self.height)
                                width: 1

                    Button:
                        text: "üìÑ Rapports"
                        font_name: 'EmojiFont'
                        color: 0, 0, 0, 1
                        font_size: '16sp'
                        background_normal: ''
                        background_color: 0.9, 0.9, 0.9, 1
                        canvas.before:
                            Color:
                                rgba: 0.7, 0.7, 0.7, 1
                            Line:
                                rectangle: (self.x, self.y, self.width, self.height)
                                width: 1

                    Button:
                        text: "d√©connexion"
                        on_release: app.logout()
                        font_name: 'EmojiFont'
                        color: 0, 0, 0, 1
                        font_size: '16sp'
                        background_normal: ''
                        background_color: 0.9, 0.9, 0.9, 1
                        canvas.before:
                            Color:
                                rgba: 0.7, 0.7, 0.7, 1
                            Line:
                                rectangle: (self.x, self.y, self.width, self.height)
                                width: 1

                # Formulaire et tableau
                BoxLayout:
                    orientation: 'vertical'
                    spacing: dp(15)
                    padding: dp(15)
                    size_hint_y: None
                    height: self.minimum_height

                    # Formulaire de recherche
                    BoxLayout:
                        size_hint_y: None
                        height: dp(50)
                        spacing: dp(10)

                        TextInput:
                            id: search_input
                            hint_text: 'üîç Rechercher...'
                            font_name: 'EmojiFont'
                            size_hint_x: 0.5
                            multiline: False
                            font_size: 18
                            foreground_color: 0, 0, 0, 1
                            cursor_color: 0, 0, 0, 1
                            background_normal: ''
                            background_color: 0.95, 0.95, 0.95, 1
                            padding: dp(5)

                        Button:
                            text: "üîé Rechercher"
                            font_name: 'EmojiFont'
                            size_hint_x: 0.15
                            size_hint_y: None
                            height: dp(50)
                            background_normal: ''
                            background_color: 0, 0, 0, 0
                            color: 0, 0, 0, 1
                            font_size: '14sp'
                            on_press: root.search(self)
                            canvas.before:
                                Color:
                                    rgba: 0.7, 0.85, 1, 1
                                Rectangle:
                                    pos: self.pos
                                    size: self.size
                                Color:
                                    rgba: 0.5, 0.5, 0.5, 1
                                Line:
                                    rectangle: (self.x, self.y, self.width, self.height)
                                    width: 1

                        Button:
                            text: 'üîÑ R√©initialiser'
                            font_name: 'EmojiFont'
                            size_hint_x: 0.15
                            background_normal: ''
                            background_color: 1, 0.7, 0.7, 1
                            color: 0, 0, 0, 1
                            font_size: '14sp'
                            on_press: root.reset_filter(self)
                            canvas.before:
                                Color:
                                    rgba: 0.5, 0.5, 0.5, 1
                                Line:
                                    rectangle: (self.x, self.y, self.width, self.height)
                                    width: 1

                    # Bouton d'importation
                    Button:
                        text: 'üìÇ Importer un fichier Excel'
                        font_name: 'EmojiFont'
                        size_hint_y: None
                        height: dp(50)
                        background_normal: ''
                        background_color: 1, 0.85, 0.4, 1
                        color: 0, 0, 0, 1
                        font_size: '16sp'
                        on_press: root.import_data(self)
                        canvas.before:
                            Color:
                                rgba: 0.5, 0.5, 0.5, 1
                            Line:
                                rectangle: (self.x, self.y, self.width, self.height)
                                width: 1

                    # √âtiquette de statut
                    Label:
                        id: status_label
                        text: '‚ÑπÔ∏è Statut : Pr√™t'
                        font_name: 'EmojiFont'
                        size_hint_y: None
                        height: dp(30)
                        color: 0.2, 0.2, 0.2, 1
                        font_size: '14sp'

                    # Tableau de donn√©es
                    BoxLayout:
                        orientation: 'vertical'
                        size_hint_x: 1
                        size_hint_y: None
                        height: dp(400)
                        canvas.before:
                            Color:
                                rgba: 0, 0, 0, 1
                            Line:
                                rectangle: (self.x, self.y, self.width, self.height)
                                width: 1

                        ScrollView:
                            id: header_scroll
                            do_scroll_x: True
                            do_scroll_y: False
                            bar_width: dp(10)
                            size_hint_y: None
                            height: dp(40)

                            GridLayout:
                                id: header_grid
                                size_hint_y: None
                                height: dp(40)
                                size_hint_x: None
                                width: self.minimum_width
                                cols: 1
                                spacing: dp(1)
                                padding: dp(1)

                        ScrollView:
                            id: table_scroll
                            do_scroll_x: True
                            do_scroll_y: True
                            bar_width: dp(10)

                            GridLayout:
                                id: table_grid
                                size_hint_y: None
                                height: self.minimum_height
                                size_hint_x: None
                                width: self.minimum_width
                                spacing: dp(1)
                                padding: dp(1)
                                cols: 1

                    # Cases √† cocher pour typeChaine et chainePicure
                    BoxLayout:
                        orientation: 'vertical'
                        opacity: 1 if root.show_checkbox else 0
                        disabled: not root.show_checkbox
                        id: my_checkbox
                        size_hint_y: None
                        height:self.minimum_height
                        padding: dp(20)
                        spacing: dp(15)

                        # Titre principal
                        Label:
                            text: "üõ†Ô∏è S√©lectionner type de cha√Æne"
                            font_name: 'EmojiFont'
                            font_size: 28
                            bold: True
                            color: 0.2, 0.2, 0.2, 1
                            size_hint_y: None
                            height: dp(50)
                            canvas.before:
                                Color:
                                    rgba: 0.92, 0.92, 0.92, 1
                                Rectangle:
                                    pos: self.pos
                                    size: self.size

                        # Toutes les cases √† cocher
                        GridLayout:
                            cols: 2
                            size_hint_y: None
                            height: size_hint_y: None
                            height: self.minimum_height
                            spacing: dp(30)
                            padding: dp(30)
                            row_default_height: dp(40)
                            row_force_default: True
                            id:type_chaine
                            canvas.before:
                                Color:
                                    rgba: 0.98, 0.98, 0.98, 1
                                Rectangle:
                                    pos: self.pos
                                    size: self.size
                                Color:
                                    rgba: 0.6, 0.6, 0.6, 1
                                Line:
                                    rectangle: (self.x, self.y, self.width, self.height)
                                    width: 1

                        Button:
                            text: "Enregistrer"
                            color: 0, 0, 0, 1
                            font_size: '16sp'
                            size_hint_y: None
                            height: dp(50)
                            background_normal: ''
                            background_color: 1, 0.85, 0.4, 1
                            canvas.before:
                                Color:
                                    rgba: 0.7, 0.7, 0.7, 1
                                Line:
                                    rectangle: (self.x, self.y, self.width, self.height)
                                    width: 1